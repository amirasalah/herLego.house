---
import type { SanityDocument } from '@sanity/client';
import { loadQuery } from '../../../sanity/lib/load-query';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import Header from '../../components/Header.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';
import { ViewTransitions, fade } from 'astro:transitions';

export const getStaticPaths = async () => {
	const { data: posts } = await loadQuery<SanityDocument[]>({ query: `*[_type == "blog"]` });

	return posts.map(({ slug }) => ({ params: { slug: slug.current } }));
};
const { params } = Astro;

const { data: post } = await loadQuery<SanityDocument>({
	query: `*[_type == "blog" && slug.current == $slug][0]`,
	params,
});
---

<html lang='en'>
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<ViewTransitions />
	</head>
	<body class='font-Montserrat grid grid-rows-10 h-screen'>
		<Header />
		<main class='container mx-auto row-span-8' transition:animate={fade({ duration: 1000 })}>
			<section class='row-span-3'>
				<h1><strong>{post.title}</strong></h1>
				<article>{post.body}</article>
			</section>
		</main>
		<Footer />
	</body>
</html>
